#!/bin/sh
clear
echo ""
echo "██████╗ ██╗███╗   ██╗ ██████╗ ██╗   ██╗██╗███╗   ██╗"
echo "██╔══██╗██║████╗  ██║██╔════╝ ██║   ██║██║████╗  ██║"
echo "██████╔╝██║██╔██╗ ██║██║  ███╗██║   ██║██║██╔██╗ ██║"
echo "██╔═══╝ ██║██║╚██╗██║██║   ██║╚██╗ ██╔╝██║██║╚██╗██║"
echo "██║     ██║██║ ╚████║╚██████╔╝ ╚████╔╝ ██║██║ ╚████║"
echo "╚═╝     ╚═╝╚═╝  ╚═══╝ ╚═════╝   ╚═══╝  ╚═╝╚═╝  ╚═══╝"
echo ""
echo "           320KG OF OPERATIONAL POWER!"
echo "============================================"
echo ""

echo "[*] Mounting filesystems..."
mount -t proc none /proc
mount -t sysfs none /sys
mount -t devtmpfs none /dev
mount -t tmpfs none /tmp

[ -e /dev/null ] || mknod -m 666 /dev/null c 1 3
[ -e /dev/console ] || mknod -m 600 /dev/console c 5 1

echo "pingvin320kg" > /proc/sys/kernel/hostname

echo "[*] Setting up network..."
ip link set lo up

echo "nameserver 8.8.8.8" > /etc/resolv.conf
echo "nameserver 1.1.1.1" >> /etc/resolv.conf

sleep 2

for iface in /sys/class/net/*; do
    iface_name=$(basename "$iface")
    if [ "$iface_name" != "lo" ] && [ "$iface_name" != "sit0" ]; then
        echo "[*] Found interface: $iface_name"
        
        ip link set "$iface_name" up
        sleep 1
        
        echo "[*] Getting IP via DHCP..."
        udhcpc -i "$iface_name" -s /etc/udhcpc.script -n -q
        
        # Проверяем результат
        IP=$(ip addr show "$iface_name" | grep 'inet ' | awk '{print $2}')
        if [ -n "$IP" ]; then
            echo "[OK] Interface $iface_name: $IP"
        else
            echo "[!] Failed to get IP on $iface_name"
        fi
    fi
done

export PATH=/bin:/sbin:/usr/bin:/usr/sbin
export HOME=/root

echo ""
echo "============================================"
echo "  SYSTEM LOADED!"
echo "============================================"
echo "Kernel: $(uname -r)"
echo "Hostname: $(hostname)"
echo "Welcome to Pingvin 320KG OS!"
echo ""
echo "Network status:"
ip addr show | grep "inet " | grep -v "127.0.0.1"
echo ""

while true; do
    setsid sh -c 'exec sh </dev/console >/dev/console 2>&1'
    echo ""
    echo "[!] Shell terminated. Restarting..."
    sleep 2
done
